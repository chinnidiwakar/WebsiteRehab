<!DOCTYPE html>
<html lang="en">
  <head>
  <title>Hackthebox Access Walkthrough</title>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0,shrink-to-fit=no" />
  <link rel="stylesheet" media="screen" href="../../css/screen.css" />
  </head>
  <header class = "header">
    <nav>
      <ul>
        <li><a href="../../about/index.html">About</a></li>
        <li><a href="../../resume/index.html">Resume</a></li>
        <li><a href="../../work/index.html">Work</a></li>
        <li><a href="../../contact/index.html">Contact</a></li>
      </ul>
    </nav>
  </header>
  <body class = "access">
  <h1>HTB Access Walkthrough</h1>
  <h2>Updated On: 03/03/19</h2>
  <p>This was my first box that I pwned on HTB. Let's get started.</p>
  <h3>nmap scan</h3>
  <p>The first thing I noticed was that anonymous FTP logins were allowed - time to explore.</p>
  <img src="access_ss/nmap.png" alt="nmap scan">
  <h4>Note: Telnet is also open (we'll need that for later)</h4>

  <h3>Port 21 - FTP</h3>
  <p> I logged in as "ftp" (no password needed).</p>
  <img src="access_ss/ftp_login.png" alt="ftp login">
  <p> There's a directory called "Backups" with a Microsoft Database file in it, so I transferred that to my Kali box to investigate it further.</p>
  <img src="access_ss/ftp_list.png" alt="ftp list">
  <h4> Note: the binary command will change the file transfer mode from ASCII to binary. This is so you can transmit a file other than ASCII from the FTP server.</h4>
  <img src="access_ss/ftp_backup_transfer.png" alt="ftp backup transfer">
  <p> There's also a zip folder in the "Engineers" directory that I transferred over as well.</p>
  <img src="access_ss/ftp_zip_transfer.png" alt="ftp zip transfer">

  <h3> File Analysis </h3>
  <p> The zip folder was password protected, so I figured that the password would be located somewhere in the database that I just transferred over.</p>
  <p> Since the database is in a specific format that isn't natively compatible with Kali, I found a tool called mdb-tools that allowed me to export the tables to CSV files.</p>
  <p> There's a long list of tables, so I just decided to export them all.</p>
  <img src="access_ss/tables_list.png" alt="mdb tables list">
  <p>The command to export all of the tables is:</p>
  <pre><code class="bash">mdb-tables -d ‘,’ backup.mdb | xargs -L1 -d’,’ -I{} bash -c ‘mdb-export backup.mdb “$1” > “$1”.csv’ --{}</code></pre>
  <a href="https://stackoverflow.com/questions/18370387/mdb-export-not-creating-csv-file"> Reference link for the exporting command.</a></p>
  <p> One of the tables titled "auth_user" had a short list of what looked like were usernames and passwords.</p>
  <img src="access_ss/auth_user.png" alt="auth users csv">
  <p> The password that worked was "access4u@security" to open the zip folder.</p>
  <img src="access_ss/zip.png" alt="zip folder">
  <p> The unzipped folder gives us a .pst file (Microsoft Outlook file) and I used the "readpst" tool on Kali to convert it so I could read it.</p>
  <p> As you can see in the email below, the new password for the "security" account is "4Cc3ssC0ntr0ller".</p>
  <img src="access_ss/email.png" alt="email">

  <h3>Port 23 - Telnet</h3>
  <p> This is where telnet comes into play. You can login as the "security" account onto their server.</p>
  <img src="access_ss/telnet.png" alt="telnet">
  <p> If you navigate to the user's desktop folder, you will find the user's flag. The "more" command allows you to read txt files from the command line.</p>
  <img src="access_ss/user.png" alt="user flag">

  <h3> Privilege Escalation - Admin</h3>
  <p> I didn't have access to to the Administrator folder where the root flag was so I had to do some digging.</p>
  <p> The "cmdkey /list" command will show you any stored credentials on the machine.</p>
  <img src="access_ss/cmdkey.png" alt="cmdkey">
  <p> Conveniently enough, the Administrator credentials are stored on this machine, which means that we can run certain commands as an Administrator. *cue evil laugh*</p>
  <p> The only limitation with this is that I can only run .exe files as an Admin.</p>
  <p> I wanted to get a reverse shell going on the machine so I could view the file as an Admin. I had to get netcat on the machine first, so I set up a simple Python HTTP
    server to transfer the exe over.</p>
  <img src="access_ss/pythonserver.png" alt="python server">
  <h4> Note: ignore the first two GET commands in that screenshot, I was testing out a PowerShell exploit that didn't work out.</h4>
  <p> Once your server is running, you can go back to the Windows machine and use PowerShell to download the .exe file.</p>
  <img src="access_ss/ncdownload.png" alt="netcat download">
  <p> Once the exe is downloaded, you can set up your listener on Kali. <a href ="https://netsec.ws/?p=292">Reference link to set up a listener.</a></p>
  <img src="access_ss/nclistener.png" alt="netcat listener">
  <p> Next, you can run netcat as an admin to spawn the shell. </p>
  <img src="access_ss/runas.png" alt="runas command">
  <p> The "/savecred" parameter allows you to use those stored Admin credentials to run the command. The "/env" parameter keeps it in the same command line environment.</p>
  <img src="access_ss/shell.png" alt="shell">
  <p> We have a shell! Now, you can navigate to the Admin's Desktop and view the root flag file.
  If you're confused about any of the commands I used to escalate to root, <a href ="https://blog.ropnop.com/transferring-files-from-kali-to-windows/">
    here's a link to the tutorial I used to get the reverse shell going.</a></p>
  <img src="access_ss/root.png" alt="root">
    <h4><a href="../../work/pentesting/index.html">Check out my other pen testing walkthroughs here</a></h4>
  </body>
<footer class = "mFooter">
  <p>Copyright © Akvile Kiskis. All rights reserved.</p>
</footer>
</html>
